<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HASAN TELECOM Vault</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'}</script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
body { font-family: 'Inter', sans-serif; transition: background-color 0.3s, color 0.3s; }
input::placeholder { color:#64748b; }
</style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 p-4 flex flex-col items-center gap-6">

<!-- HEADER -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900 border rounded-[32px] p-8 flex flex-col items-center shadow-xl text-center">
  <h1 class="text-3xl font-black text-blue-600 dark:text-blue-500 uppercase mb-1">HASAN TELECOM</h1>
  <p id="modeIndicator" class="text-xs text-slate-400 uppercase mb-6">STAFF VIEW MODE</p>
  <div class="flex items-center gap-4">
    <button onclick="toggleTheme()" class="p-4 rounded-2xl bg-slate-100 dark:bg-slate-800">
      <span id="themeIcon">ðŸŒ™</span>
    </button>
    <button id="adminBtn" onclick="toggleAdmin()" class="bg-blue-600 text-white px-10 py-4 rounded-2xl font-black uppercase text-sm tracking-widest">LOGIN</button>
    <div id="adminTools" class="hidden flex gap-2">
      <button onclick="generatePDF()" class="bg-orange-600 p-4 rounded-2xl text-white">ðŸ“„</button>
      <button onclick="logout()" class="bg-red-600 p-4 rounded-2xl text-white">âœ•</button>
    </div>
  </div>
</div>

<!-- SEARCH -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900/50 border rounded-[32px] p-6 mt-4 shadow-xl">
  <div class="relative">
    <input type="text" id="searchInput" onkeyup="render()" placeholder="Search inventory..." class="w-full bg-slate-100 dark:bg-slate-950 border p-4 rounded-2xl text-slate-900 dark:text-slate-300 focus:ring-2 focus:ring-blue-500">
  </div>
</div>

<!-- VAULT CONTENT -->
<div id="vaultContent" class="w-full max-w-xl space-y-3 mt-4"></div>
<div id="emptyState" class="hidden p-20 text-center text-slate-400 italic text-xs">No items found</div>

<!-- FIREBASE & APP LOGIC -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

// ---------- FIREBASE CONFIG ----------
const firebaseConfig = {
  apiKey: "AIzaSyD2_M0SwhaQ90wuEVBdDP91zBc2GDWKglQ",
  authDomain: "hasan-telecom-ad91e.firebaseapp.com",
  databaseURL: "https://hasan-telecom-ad91e-default-rtdb.firebaseio.com",
  projectId: "hasan-telecom-ad91e",
  storageBucket: "hasan-telecom-ad91e.appspot.com",
  messagingSenderId: "199331841561",
  appId: "1:199331841561:web:3e2ef8bdb21f222ee5cc88"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ---------- APP STATE ----------
const ADMIN_PASSWORD = "511436";
let isAdmin = false;
let data = [];

// ---------- THEME ----------
function applyTheme(theme) {
  if(theme === 'dark') {
    document.documentElement.classList.add('dark');
    document.getElementById('themeIcon').innerText = 'â˜€ï¸';
  } else {
    document.documentElement.classList.remove('dark');
    document.getElementById('themeIcon').innerText = 'ðŸŒ™';
  }
  localStorage.setItem('theme', theme);
}

function toggleTheme() {
  const current = localStorage.getItem('theme') || 'dark';
  applyTheme(current==='dark'?'light':'dark');
}

document.addEventListener('DOMContentLoaded', () => {
  const savedTheme = localStorage.getItem('theme') || 'dark';
  applyTheme(savedTheme);
});

// ---------- ADMIN LOGIN ----------
function toggleAdmin() {
  const key = prompt("Enter Admin Password:");
  if(key === ADMIN_PASSWORD) {
    isAdmin = true;
    alert("Admin login successful!");
  } else {
    alert("Incorrect password!");
    isAdmin = false;
  }
  updateUI();
}

function logout() {
  isAdmin = false;
  updateUI();
}

function updateUI() {
  document.getElementById('adminTools').classList.toggle('hidden', !isAdmin);
  document.getElementById('adminBtn').classList.toggle('hidden', isAdmin);
  document.getElementById('modeIndicator').innerText = isAdmin?"ADMIN AUTHORIZED":"STAFF VIEW MODE";
  render();
}

// ---------- FIREBASE FUNCTIONS ----------
function loadInventory() {
  const dbRef = ref(db, 'inventory');
  onValue(dbRef, snapshot => {
    const val = snapshot.val();
    data = val ? Object.values(val) : [];
    render();
  });
}

function saveItem(item) {
  if(!item.id) item.id = Date.now().toString(); // ensure unique id
  set(ref(db, 'inventory/' + item.id), item);
}

function deleteItem(id) {
  if(confirm("Delete this item?")) {
    remove(ref(db, 'inventory/' + id));
  }
}

// ---------- RENDER ----------
function render() {
  const search = document.getElementById('searchInput').value.toLowerCase();
  const container = document.getElementById('vaultContent');
  const filtered = data.filter(i => `${i.brand} ${i.name} ${i.cat || ''}`.toLowerCase().includes(search));

  container.innerHTML = '';
  if(filtered.length === 0){ 
    document.getElementById('emptyState').classList.remove('hidden'); 
    return;
  } else { 
    document.getElementById('emptyState').classList.add('hidden'); 
  }

  filtered.forEach(item => {
    container.innerHTML += `
    <div class="bg-white dark:bg-slate-900 rounded-[24px] border p-4">
      <div class="flex justify-between items-center">
        <div>
          <span class="font-bold">${item.brand}</span> - ${item.name} 
        </div>
        <div class="cursor-pointer" onclick="item.inStock=!item.inStock; saveItem(item); render();">
          ${item.inStock?'<span class="text-green-500">IN STOCK</span>':'<span class="text-red-500">OUT</span>'}
        </div>
        ${isAdmin?`<button class="text-red-500" onclick="deleteItem('${item.id}')">âœ•</button>`:''}
      </div>
    </div>`;
  });
}

// ---------- PDF EXPORT ----------
function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(20);
  doc.text("HASAN TELECOM - INVENTORY REPORT",14,20);
  const rows = data.map(i => [i.brand, i.name, i.cat||'', i.inStock?"YES":"NO", i.price||"Contact"]);
  doc.autoTable({startY:30, head:[['Brand','Model','Category','Available','Price']], body:rows});
  doc.save('HasanTelecom_Report.pdf');
}

// ---------- INIT ----------
loadInventory();
</script>

<!-- ---------- SERVICE WORKER ----------
Ensure offline caching ---------- -->
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
    .then(()=>console.log("Service Worker Registered"))
    .catch(err=>console.error(err));
}
</script>

</body>
</html>
